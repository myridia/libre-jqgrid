(e=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):"object"==typeof module&&module.exports?module.exports=function(i,s){return i=i||window,void 0===s&&(s="undefined"!=typeof window?require("jquery"):require("jquery")(i)),require("./grid.base"),e(s),s}:e(jQuery)})(function(x){function w(){var i=x.makeArray(arguments);return i[0]="subGrid"+i[0].charAt(0).toUpperCase()+i[0].substring(1),i.unshift(""),i.unshift(""),i.unshift(this.p),S.feedback.apply(this,i)}function s(s,e){return this.each(function(){var i;this.grid&&null!=s&&!0===this.p.subGrid&&(i=x(this).jqGrid("getInd",s,!0),x(i).find(">td."+e).trigger("click"))})}var S=x.jgrid,j=S.jqID,C=x.fn.jqGrid;S.extend({setSubGrid:function(){return this.each(function(){function i(i){return t.jqGrid("getIconRes",i)}var s,e=this.p,t=x(this),r=e.subGridModel[0];if(e.subGridOptions=x.extend({commonIconClass:i("subgrid.common"),plusicon:i("subgrid.plus"),minusicon:i("subgrid.minus"),openicon:"rtl"===e.direction?i("subgrid.openRtl"):i("subgrid.openLtr"),expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0},e.subGridOptions||{}),e.colNames.unshift(""),e.colModel.unshift({name:"subgrid",width:S.cell_width?e.subGridWidth+e.cellLayout:e.subGridWidth,labelClasses:"jqgh_subgrid",sortable:!1,resizable:!1,hidedlg:!0,search:!1,fixed:!0,frozen:!0}),r)for(r.align=x.extend([],r.align||[]),s=0;s<r.name.length;s++)r.align[s]=r.align[s]||"left"})},addSubGridCell:function(i,s,e,t){var r=this[0],n=r.p.subGridOptions,e=!x.jgrid.isFunction(n.hasSubgrid)||n.hasSubgrid.call(r,{rowid:e,iRow:s,iCol:i,data:t});return null==r.p?"":"<td role='gridcell' class='"+C.getGuiStyles.call(this,"subgrid.tdStart",e?"ui-sgcollapsed sgcollapsed":"")+"' "+r.formatCol(i,s)+">"+(e?"<div class='"+C.getGuiStyles.call(this,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+C.getGuiStyles.call(this,"subgrid.button","sgbutton")+"'><span class='"+S.mergeCssClasses(n.commonIconClass,n.plusicon)+"'></span></a></div>":"&nbsp;")+"</td>"},addSubGrid:function(y,v){return this.each(function(){function i(){function i(i){return S.mergeCssClasses(o.subGridOptions.commonIconClass,o.subGridOptions[i])}var s,e=x(this).parent("tr")[0],t=e.nextSibling,r=e.id,n=o.id+"_"+r,l=1;if(x.each(o.colModel,function(){!0!==this.hidden&&"rn"!==this.name&&"cb"!==this.name||l++}),x(this).hasClass("sgcollapsed")){if(!0===o.subGridOptions.reloadOnExpand||!1===o.subGridOptions.reloadOnExpand&&!x(t).hasClass("ui-subgrid")){if(s=1<=y?"<td colspan='"+y+"'>&#160;</td>":"",!w.call(d,"beforeExpand",n,r))return;x(e).after("<tr role='row' class='"+p+"'>"+s+"<td class='"+b+"'><span class='"+i("openicon")+"'></span></td><td colspan='"+parseInt(o.colNames.length-l,10)+"' class='"+h+"'><div id='"+n+"' class='tablediv'></div></td></tr>"),x(d).triggerHandler("jqGridSubGridRowExpanded",[n,r]),x.jgrid.isFunction(o.subGridRowExpanded)?o.subGridRowExpanded.call(d,n,r):G(e)}else x(t).show();x(this).html("<div class='"+C.getGuiStyles.call(d,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+C.getGuiStyles.call(d,"subgrid.button","sgbutton")+"'><span class='"+i("minusicon")+"'></span></a></div>").removeClass("sgcollapsed").addClass("sgexpanded"),o.subGridOptions.selectOnExpand&&x(d).jqGrid("setSelection",r)}else if(x(this).hasClass("sgexpanded")){if(!w.call(d,"beforeCollapse",n,r))return;!0===o.subGridOptions.reloadOnExpand?x(t).remove(".ui-subgrid"):x(t).hasClass("ui-subgrid")&&x(t).hide(),x(this).html("<div class='"+C.getGuiStyles.call(d,"subgrid.buttonDiv","sgbutton-div")+"'><a role='button' class='"+C.getGuiStyles.call(d,"subgrid.button","sgbutton")+"'><span class='"+i("plusicon")+"'></span></a></div>").removeClass("sgexpanded").addClass("sgcollapsed"),o.subGridOptions.selectOnCollapse&&x(d).jqGrid("setSelection",r)}return!1}var s,e,t,d=this,o=d.p,u=o.subGridModel[0],a=function(i,s){return C.getGuiStyles.call(d,"subgrid."+i,s||"")},c=a("thSubgrid","ui-th-subgrid ui-th-column ui-th-"+o.direction),g=a("rowSubTable","ui-subtblcell"),p=a("row","ui-subgrid ui-row-"+o.direction),b=a("tdWithIcon","subgrid-cell"),h=a("tdData","subgrid-data"),f=function(i,s,e){e=u.align[e],e=x("<td"+(e?" style='text-align:"+e+";'":"")+"></td>").html(s);i.append(e)},n=function(i,t){var r=o.xmlReader.subgrid;x(r.root+" "+r.row,i).each(function(){var i,s,e=x("<tr class='"+g+"'></tr>");if(!0===r.repeatitems)x(r.cell,this).each(function(i){f(e,x(this).text()||"&#160;",i)});else if(i=u.mapping||u.name)for(s=0;s<i.length;s++)f(e,S.getXmlData(this,i[s])||"&#160;",s);t.append(e)})},l=function(i,s){var e,t,r,n,l,d=o.jsonReader.subgrid,a=S.getAccessor(i,d.root);if(null!=a)for(t=0;t<a.length;t++){if(l=a[t],e=x("<tr class='"+g+"'></tr>"),!0===d.repeatitems)for(d.cell&&(l=l[d.cell]),r=0;r<l.length;r++)f(e,l[r]||"&#160;",r);else if((n=u.mapping||u.name).length)for(r=0;r<n.length;r++)f(e,S.getAccessor(l,n[r])||"&#160;",r);s.append(e)}},m=function(i,s,e){var t,r,n=a("legacyTable","ui-jqgrid-legacy-subgrid"+(!0===o.altRows&&x(d).jqGrid("isBootstrapGuiStyle")?" table-striped":"")),n=x("<table"+(n?" style='width:1px' role='presentation' class='"+n+"'":"")+"><thead></thead><tbody></tbody></table>"),l=x("<tr></tr>");for(d.grid.endReq.call(d),r=0;r<u.name.length;r++)t=x("<th class='"+c+"'></th>").html(u.name[r]).width(u.width[r]),l.append(t);return l.appendTo(n[0].tHead),e(i,x(n[0].tBodies[0])),x("#"+j(o.id+"_"+s)).append(n),!1},G=function(i){var s,e,t=x(i).attr("id"),r={nd_:(new Date).getTime()};if(r[o.prmNames.subgridid]=t,u){if(u.params)for(e=0;e<u.params.length;e++)void 0!==(s=o.iColByName[u.params[e]])&&(r[o.colModel[s].name]=x(i.cells[s]).text().replace(/\&#160\;/gi,""));if(!d.grid.hDiv.loading)switch(d.grid.beginReq.call(d),o.subgridtype||(o.subgridtype=o.datatype),x.jgrid.isFunction(o.subgridtype)?o.subgridtype.call(d,r):o.subgridtype=o.subgridtype.toLowerCase(),o.subgridtype){case"xml":case"json":x.ajax(x.extend({type:o.mtype,url:x.jgrid.isFunction(o.subGridUrl)?o.subGridUrl.call(d,r):o.subGridUrl,dataType:o.subgridtype,context:t,data:S.serializeFeedback.call(d,o.serializeSubGridData,"jqGridSerializeSubGridData",r),success:function(i){m(i,this,"xml"===o.subgridtype?n:l)},error:function(i,s,e){var t=void 0===o.loadSubgridError?o.loadError:o.loadSubgridError;d.grid.endReq.call(d),x.jgrid.isFunction(t)&&t.call(d,i,s,e),o.subGridOptions.noEmptySubgridOnError||m(null,this,"xml"===o.subgridtype?n:l)}},S.ajaxOptions,o.ajaxSubgridOptions||{}))}}return!1},r=1;if(d.grid){for(s=d.rows.length,void 0!==v&&0<v&&(s=(r=v)+1);r<s;)e=d.rows[r],x(e).hasClass("jqgrow")&&(e=x(e.cells[y])).hasClass("ui-sgcollapsed")&&(o.scroll&&e.off("click"),e.on("click",i)),r++;!0===o.subGridOptions.expandOnLoad&&(t=o.iColByName.subgrid,x(d.rows).filter(".jqgrow").each(function(i,s){x(s.cells[t]).filter(".sgcollapsed").children(".sgbutton-div").children(".sgbutton").click()})),d.subGridXml=function(i,s){return m(i,s,n)},d.subGridJson=function(i,s){return m(i,s,l)}}})},expandSubGridRow:function(i){return s.call(this,i,"sgcollapsed")},collapseSubGridRow:function(i){return s.call(this,i,"sgexpanded")},toggleSubGridRow:function(i){return s.call(this,i,"ui-sgcollapsed")}})});
//# sourceMappingURL=grid.subgrid.js.map