(t=>{"function"==typeof define&&define.amd?define(["jquery","./grid.base"],t):"object"==typeof module&&module.exports?module.exports=function(e,r){return e=e||window,void 0===r&&(r="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),t(r),r}:t(jQuery)})(function(T){function n(){var e=T.makeArray(arguments);return e[0]="treeGrid"+e[0].charAt(0).toUpperCase()+e[0].substring(1),e.unshift(""),e.unshift(""),e.unshift(this.p),S.feedback.apply(this,e)}function o(e,r){var r=r[e.treeReader.icon_field],t=(e=e.treeIcons).plus+" tree-plus",a=e.minus+" tree-minus";return r&&"string"==typeof r&&2===(r=r.split(",")).length&&(a=r[0],t=r[1]),{expanded:a,collapsed:t,common:e.commonIconClass}}var S=T.jgrid,p=S.getAccessor,c=S.stripPref,u=S.jqID,k=T.fn.jqGrid;S.extend({setTreeNode:function(){return this.each(function(){var l,n,e=this,o=T(e),s=e.p;e.grid&&s.treeGrid&&(l=s.treeReader.expanded_field,n=s.treeReader.leaf_field,o.off("jqGridBeforeSelectRow.setTreeNode"),o.on("jqGridBeforeSelectRow.setTreeNode",function(e,t,r){var a,d,i;if(null!=r)return a=(r=T(r.target)).closest("tr.jqgrow>td"),d=a.parent(),i=function(){var e=s.data[s._index[c(s.idPrefix,t)]],r=e[l]?"collapse":"expand";e[n]||(k[r+"Row"].call(o,e,d),k[r+"Node"].call(o,e,d))},(r.is("div.treeclick")||s.ExpandColClick&&0<a.length&&0<r.closest("span.cell-wrapper",a).length)&&i(),!0}))})},setTreeGrid:function(){return this.each(function(){var e,r,t,a=this.p,d=[],i=["leaf_field","expanded_field","loaded"];if(a.treeGrid){for(r in a.treedatatype||T.extend(this.p,{treedatatype:a.datatype}),a.subGrid=!1,a.altRows=!1,a.pgbuttons=!1,a.pginput=!1,a.gridview=!0,null===a.rowTotal&&(a.rowNum=a.maxRowNum),a.rowList=[],a.treeIcons.plus="rtl"===a.direction?a.treeIcons.plusRtl:a.treeIcons.plusLtr,"nested"===a.treeGridModel?a.treeReader=T.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},a.treeReader):"adjacency"===a.treeGridModel&&(a.treeReader=T.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded",loaded:"loaded",icon_field:"icon"},a.treeReader)),a.colModel)if(a.colModel.hasOwnProperty(r))for(t in e=a.colModel[r].name,a.treeReader)a.treeReader.hasOwnProperty(t)&&a.treeReader[t]===e&&d.push(e);T.each(a.treeReader,function(e){var r=String(this);r&&-1===T.inArray(r,d)&&(0<=T.inArray(e,i)?a.additionalProperties.push({name:r,search:!1,convert:function(e){return!0===e||"true"===String(e).toLowerCase()||"1"===String(e)||e}}):a.additionalProperties.push(r))})}})},expandRow:function(l){this.each(function(){var r,e,t,a=this,d=T(a),i=a.p;a.grid&&i.treeGrid&&(r=i.treeReader.expanded_field,e=l[i.localReader.id],n.call(a,"beforeExpandRow",{rowid:e,item:l}))&&(t=k.getNodeChildren.call(d,l),T(t).each(function(){var e=i.idPrefix+p(this,i.localReader.id);T(k.getGridRowById.call(d,e)).css("display",""),this[r]&&k.expandRow.call(d,this)}),n.call(a,"afterExpandRow",{rowid:e,item:l}))})},collapseRow:function(l){this.each(function(){var r,e,t,a=this,d=T(a),i=a.p;a.grid&&i.treeGrid&&(r=i.treeReader.expanded_field,e=l[i.localReader.id],n.call(a,"beforeCollapseRow",{rowid:e,item:l}))&&(t=k.getNodeChildren.call(d,l),T(t).each(function(){var e=i.idPrefix+p(this,i.localReader.id);T(k.getGridRowById.call(d,e)).css("display","none"),this[r]&&k.collapseRow.call(d,this)}),n.call(a,"afterCollapseRow",{rowid:e,item:l}))})},getRootNodes:function(){var a=[];return this.each(function(){var e=this.p;if(this.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var r=e.treeReader.level_field;T(e.data).each(function(){parseInt(this[r],10)===parseInt(e.tree_root_level,10)&&a.push(this)});break;case"adjacency":var t=e.treeReader.parent_id_field;T(e.data).each(function(){null!==this[t]&&"null"!==String(this[t]).toLowerCase()||a.push(this)})}}),a},getNodeDepth:function(t){var a=null;return this.each(function(){var e=this.p;if(this.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var r=e.treeReader.level_field;a=parseInt(t[r],10)-parseInt(e.tree_root_level,10);break;case"adjacency":a=k.getNodeAncestors.call(T(this),t).length}}),a},getNodeParent:function(e){var r,t,a,d,i,l,n,o,s,c=this[0];return c&&c.grid&&null!=c.p&&c.p.treeGrid&&null!=e?(r=e[(s=(c=c.p).treeReader).parent_id_field],"nested"===c.treeGridModel?(t=null,a=s.left_field,d=s.right_field,i=s.level_field,l=parseInt(e[a],10),n=parseInt(e[d],10),o=parseInt(e[i],10),T(c.data).each(function(){if(parseInt(this[i],10)===o-1&&parseInt(this[a],10)<l&&parseInt(this[d],10)>n)return t=this,!1}),t):null!==r&&"null"!==r&&void 0!==(s=c._index[r])?c.data[s]:null):null},getNodeChildren:function(s){var c=[];return this.each(function(){var e=this.p;if(this.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var r=e.treeReader.left_field,t=e.treeReader.right_field,a=e.treeReader.level_field,d=parseInt(s[r],10),i=parseInt(s[t],10),l=parseInt(s[a],10);T(e.data).each(function(){parseInt(this[a],10)===l+1&&parseInt(this[r],10)>d&&parseInt(this[t],10)<i&&c.push(this)});break;case"adjacency":var n=e.treeReader.parent_id_field,o=e.localReader.id;T(e.data).each(function(){String(this[n])===String(s[o])&&c.push(this)})}}),c},getFullTreeNode:function(c){var f=[];return this.each(function(){var r,t,a,e=this.p;if(this.grid&&e.treeGrid)switch(e.treeGridModel){case"nested":var d=e.treeReader.left_field,i=e.treeReader.right_field,l=e.treeReader.level_field,n=parseInt(c[d],10),o=parseInt(c[i],10),s=parseInt(c[l],10);T(e.data).each(function(){parseInt(this[l],10)>=s&&parseInt(this[d],10)>=n&&parseInt(this[d],10)<=o&&f.push(this)});break;case"adjacency":c&&(f.push(c),t=e.treeReader.parent_id_field,a=e.localReader.id,T(e.data).each(function(){var e;for(r=f.length,e=0;e<r;e++)if(String(f[e][a])===String(this[t])){f.push(this);break}}))}}),f},getNodeAncestors:function(a){var d=[];return this.each(function(){var e=T(this),r=k.getNodeParent;if(this.grid&&this.p.treeGrid)for(var t=r.call(e,a);t;)d.push(t),t=r.call(e,t)}),d},isVisibleNode:function(a){var d=!0;return this.each(function(){var e,r,t=this.p;this.grid&&t.treeGrid&&(e=k.getNodeAncestors.call(T(this),a),r=t.treeReader.expanded_field,T(e).each(function(){if(!(d=d&&this[r]))return!1}))}),d},isNodeLoaded:function(t){var a;return this.each(function(){var e,r=this.p;this.grid&&r.treeGrid&&(e=r.treeReader.leaf_field,r=r.treeReader.loaded,a=void 0!==t&&(void 0!==t[r]?t[r]:!!(t[e]||0<k.getNodeChildren.call(T(this),t).length)))}),a},expandNode:function(l){return this.each(function(){var e,r,t,a,d=this,i=d.p;d.grid&&i.treeGrid&&(a=i.treeReader,l[a.expanded_field]||(e=p(l,i.localReader.id),n.call(d,"beforeExpandNode",{rowid:e,item:l})&&(r=T("#"+i.idPrefix+u(e),d.grid.bDiv)[0],l[a.expanded_field]=!0,t=o(i,l),T("div.treeclick",r).removeClass(t.collapsed).addClass(t.common).addClass(t.expanded),"local"===i.treedatatype||k.isNodeLoaded.call(T(d),i.data[i._index[e]])||d.grid.hDiv.loading||(i.treeANode=r.rowIndex,i.datatype=i.treedatatype,k.setGridParam.call(T(d),{postData:"nested"===i.treeGridModel?{nodeid:e,n_level:l[a.level_field],n_left:l[a.left_field],n_right:l[a.right_field]}:{nodeid:e,n_level:l[a.level_field],parentid:l[a.parent_id_field]}}),T(d).trigger("reloadGrid"),l[a.loaded]=!0,k.setGridParam.call(T(d),{postData:"nested"===i.treeGridModel?{nodeid:"",n_level:"",n_left:"",n_right:""}:{nodeid:"",n_level:"",parentid:""}})),n.call(d,"afterExpandNode",{rowid:e,item:l}))))})},collapseNode:function(d){return this.each(function(){var e,r,t=this,a=t.p;t.grid&&a.treeGrid&&(e=a.treeReader.expanded_field,d[e])&&(r=p(d,a.localReader.id),n.call(t,"beforeCollapseNode",{rowid:r,item:d}))&&(d[e]=!1,e=o(a,d),T("#"+a.idPrefix+u(r),t.grid.bDiv).find("div.treeclick").removeClass(e.expanded).addClass(e.common).addClass(e.collapsed),(!0===a.unloadNodeOnCollapse||T.jgrid.isFunction(a.unloadNodeOnCollapse)&&a.unloadNodeOnCollapse.call(t,d))&&(d[a.treeReader.loaded]=!1,T(t).jqGrid("delTreeNode",r,!0)),n.call(t,"afterCollapseNode",{rowid:r,item:d}))})},SortTree:function(s,c,f,h){return this.each(function(){var t=this,a=t.p,d=T(t);if(t.grid&&a.treeGrid){for(var e,r=[],i=k.getRootNodes.call(d),i=S.from.call(t,i),l=(i.orderBy(s,c,f,h),i.select()),n=0,o=l.length;n<o;n++)e=l[n],r.push(e),k.collectChildrenSortTree.call(d,r,e,s,c,f,h);T.each(r,function(e){var r=p(this,a.localReader.id);T(t.rows[e]).after(d.find(">tbody>tr#"+u(r)))})}})},collectChildrenSortTree:function(l,n,o,s,c,f){return this.each(function(){var e=T(this);if(this.grid&&this.p.treeGrid)for(var r,t=k.getNodeChildren.call(e,n),t=S.from.call(this,t),a=(t.orderBy(o,s,c,f),t.select()),d=0,i=a.length;d<i;d++)r=a[d],l.push(r),k.collectChildrenSortTree.call(e,l,r,o,s,c,f)})},setTreeRow:function(e,r){var t=!1;return this.each(function(){this.grid&&this.p.treeGrid&&(t=k.setRowData.call(T(this),e,r))}),t},delTreeNode:function(p,u){return this.each(function(){var e,r,t,a=this,d=a.p,i=d.localReader.id,l=T(a),n=d.treeReader.left_field,o=d.treeReader.right_field;if(a.grid&&d.treeGrid){var s=d._index[p];if(void 0!==s){var c,f=(c=parseInt(d.data[s][o],10))-parseInt(d.data[s][n],10)+1,h=k.getFullTreeNode.call(l,d.data[s]);if(0<h.length)for(t=0;t<h.length;t++)u&&p===h[t][i]||k.delRowData.call(l,h[t][i]);if("nested"===d.treeGridModel){if((e=S.from.call(a,d.data).greater(n,c,{stype:"integer"}).select()).length)for(r in e)e.hasOwnProperty(r)&&(e[r][n]=parseInt(e[r][n],10)-f);if((e=S.from.call(a,d.data).greater(o,c,{stype:"integer"}).select()).length)for(r in e)e.hasOwnProperty(r)&&(e[r][o]=parseInt(e[r][o],10)-f)}}}})},addChildNode:function(b,j,P,M){return this.each(function(){if(P){var e,r,t,a,d,i,l=this,n=l.p,o=T(l),s=k.getInd,c=n.treeIcons.minus+" tree-minus",f=j,h=n.treeReader.expanded_field,p=n.treeReader.leaf_field,u=n.treeReader.level_field,g=n.treeReader.parent_id_field,v=n.treeReader.left_field,_=n.treeReader.right_field,R=n.treeReader.loaded,w=(void 0===M&&(M=!1),null==b&&(b=S.randId()),s.call(o,j)),I=!1;if(null==j||""===j)f=j=null,e="last",x=n.tree_root_level;else{e="after",r=n._index[j],t=n.data[r],j=t[n.localReader.id];var m=s.call(o,j),x=parseInt(t[u],10)+1,y=k.getFullTreeNode.call(o,t);if(y.length)for(var G,N,C=0;C<y.length;C++)N=y[C][n.localReader.id],m<(G=s.call(o,N))&&(m=G,f=N);t[p]&&(t[h]=I=!0,T(l.rows[w]).find("span.cell-wrapperleaf").removeClass("cell-wrapperleaf").addClass("cell-wrapper").end().find("div.tree-leaf").removeClass(n.treeIcons.leaf+" tree-leaf").addClass(n.treeIcons.commonIconClass).addClass(c),n.data[r][p]=!1,t[R]=!0)}if(void 0===P[h]&&(P[h]=!1),void 0===P[R]&&(P[R]=!1),P[u]=x,void 0===P[p]&&(P[p]=!0),"adjacency"===n.treeGridModel&&(P[g]=j),"nested"===n.treeGridModel)if(null!==j){if(a=parseInt(t[_],10),(d=S.from.call(l,n.data).greaterOrEquals(_,a,{stype:"integer"}).select()).length)for(i in d)d.hasOwnProperty(i)&&(d[i][v]=d[i][v]>a?parseInt(d[i][v],10)+2:d[i][v],d[i][_]=d[i][_]>=a?parseInt(d[i][_],10)+2:d[i][_]);P[v]=a,P[_]=a+1}else{if(a=parseInt(k.getCol.call(o,_,!1,"max"),10),(d=S.from.call(l,n.data).greater(v,a,{stype:"integer"}).select()).length)for(i in d)d.hasOwnProperty(i)&&(d[i][v]=parseInt(d[i][v],10)+2);if((d=S.from.call(l,n.data).greater(_,a,{stype:"integer"}).select()).length)for(i in d)d.hasOwnProperty(i)&&(d[i][_]=parseInt(d[i][_],10)+2);P[v]=a+1,P[_]=a+2}(null===j||k.isNodeLoaded.call(o,t)||I)&&k.addRowData.call(o,b,P,e,f),t&&!t[h]&&M&&T(l.rows[w]).find("div.treeclick").click()}})}})});
//# sourceMappingURL=grid.treegrid.js.map